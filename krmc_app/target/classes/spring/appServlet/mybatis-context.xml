<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:mybatis="http://mybatis.org/schema/mybatis-spring"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.0.xsd
                           http://mybatis.org/schema/mybatis-spring http://mybatis.org/schema/mybatis-spring.xsd"
>

	<!--  PROJECT Default Database SqlSessionFactory -->
    <!-- <bean id="sqlSessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean"> -->
    <bean id="sqlSessionFactory" class="org.springframework.mybatis.RefreshableSqlSessionFactoryBean">
        <property name="dataSource" ref="dataSource" />
        <property name="configLocation" value="classpath:application/mybatis/mybatis-config-base.xml"/>
        <property name="mapperLocations">
            <list>
                <value>classpath:application/mybatis/mapper/${jdbc.dbname}/**/*Mapper.xml</value>
            </list>
        </property>
    </bean>
	<bean id="sqlSessionTemplate" class="org.mybatis.spring.SqlSessionTemplate" destroy-method="clearCache">
		<constructor-arg name="sqlSessionFactory" ref="sqlSessionFactory" />
	</bean>
	
	<!--  Another Database SqlSessionFactory -->
	<!-- 
    <bean id="sqlSessionFactory_another" class="org.mybatis.spring.SqlSessionFactoryBean">
        <property name="dataSource" ref="dataSource_another" />
        <property name="configLocation" value="classpath:application/mybatis/mybatis-config-base.xml"/>
        <property name="mapperLocations">
            <list>
                <value>classpath:application/mybatis/mapper/another/**/*Mapper.xml</value>
            </list>
        </property>
    </bean>
 	<bean id="sqlSessionTemplate_another" class="org.mybatis.spring.SqlSessionTemplate" destroy-method="clearCache">
		<constructor-arg name="sqlSessionFactory" ref="sqlSessionFactory_another" />
	</bean>
    -->

	<!-- scan for mappers and let them be autowired [SqlSessionFactory bean] -->
	<mybatis:scan base-package="com.doppio.**.service.impl"			factory-ref="sqlSessionFactory" />
<!-- <mybatis:scan base-package="com.another.**.service.impl"		factory-ref="sqlSessionFactory_another" />  -->	

	<!-- Mybatis ehcache with spring. Mybatis cache metrics. [hengyunabc/mybatis-ehcache-spring] -->
	<bean class="org.springframework.mybatis.SharedSpringContextSetter"/>

	<bean id="ehCacheManager" class="org.springframework.cache.ehcache.EhCacheManagerFactoryBean">
		<property name="configLocation" value="classpath:ehcache.xml" />
	</bean>

	<!-- this bean name must be mybatisCacheDefaultFactory 	-->
	<bean id="mybatisCacheDefaultFactory" class="org.springframework.mybatis.MybatisEhcacheFactory">
		<property name="cacheManager" ref="ehCacheManager"></property>
	</bean>

</beans>
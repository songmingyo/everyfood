<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.doppio.workplace.as.service.impl.SalSalesTotPrftListMapper">
	
	<!-- 통합매출처이익률(전월대비) 조회 -->
	<select id="selectSalSalesTotPrftList" parameterType="com.doppio.workplace.as.service.SalSalesTotPrftListVo" resultType="com.doppio.workplace.as.service.SalSalesTotPrftListVo">
	/*SalSalesTotPrftListMapper.selectSalSalesTotPrftList*/	
         SELECT IFNULL(TCD.DTL_NM,'') AS SALES_CLASS_NM
                , TSAI.SALES_NM
                
                , IFNULL(A.BUY_AMT_1,0) AS BUY_AMT_1
                , IFNULL(A.SALES_AMT_1,0) AS SALES_AMT_1
                , IFNULL(A.SALES_AMT_1,0) - IFNULL(A.BUY_AMT_1,0) AS PROFIT_AMT_1
                , ROUND(CASE WHEN (CASE WHEN TSAI.PROFIT_CLASS = '10' THEN A.BUY_AMT_1 ELSE A.SALES_AMT_1 END) = 0 THEN 0
                             ELSE ( A.SALES_AMT_1 - A.BUY_AMT_1) / ( CASE WHEN TSAI.PROFIT_CLASS = '10' THEN A.BUY_AMT_1 ELSE A.SALES_AMT_1 END ) * 100
			             END, 2) AS MAR_RATE_1
			             
			    , IFNULL(A.BUY_AMT_2,0) AS BUY_AMT_2
                , IFNULL(A.SALES_AMT_2,0) AS SALES_AMT_2
                , IFNULL(A.SALES_AMT_2,0) - IFNULL(A.BUY_AMT_2,0) AS PROFIT_AMT_2
                , ROUND(CASE WHEN (CASE WHEN TSAI.PROFIT_CLASS = '10' THEN A.BUY_AMT_2 ELSE A.SALES_AMT_2 END) = 0 THEN 0
                             ELSE ( A.SALES_AMT_2 - A.BUY_AMT_2) / ( CASE WHEN TSAI.PROFIT_CLASS = '10' THEN A.BUY_AMT_2 ELSE A.SALES_AMT_2 END ) * 100
			             END, 2) AS MAR_RATE_2
			    
			    , IFNULL(A.BUY_AMT_3,0) AS BUY_AMT_3
                , IFNULL(A.SALES_AMT_3,0) AS SALES_AMT_3
                , IFNULL(A.SALES_AMT_3,0) - IFNULL(A.BUY_AMT_3,0) AS PROFIT_AMT_3
                , ROUND(CASE WHEN (CASE WHEN TSAI.PROFIT_CLASS = '10' THEN A.BUY_AMT_3 ELSE A.SALES_AMT_3 END) = 0 THEN 0
                             ELSE ( A.SALES_AMT_3 - A.BUY_AMT_3) / ( CASE WHEN TSAI.PROFIT_CLASS = '10' THEN A.BUY_AMT_3 ELSE A.SALES_AMT_3 END ) * 100
			             END, 2) AS MAR_RATE_3
                
                , IFNULL(TSPM.SALES_PR_NM,'') AS SALES_PR_NM
                , IFNULL(TSAI.SUBSIDY_RATE,0) AS SUBSIDY_RATE
           FROM (SELECT 
                        <if test='searchSalesCd != null and searchSalesCd != ""'>
                          VSHC.SALES_CD
                        </if>
                        <if test='searchSalesCd == null or searchSalesCd == ""'>
                          VSHC.HQ_CD AS SALES_CD
                        </if>
                        , SUM(A.SALES_AMT_1) AS SALES_AMT_1
                        , SUM(A.SALES_AMT_2) AS SALES_AMT_2
                        , SUM(A.SALES_AMT_3) AS SALES_AMT_3
                        , SUM(A.BUY_AMT_1) AS BUY_AMT_1
                        , SUM(A.BUY_AMT_2) AS BUY_AMT_2
                        , SUM(A.BUY_AMT_3) AS BUY_AMT_3
                   FROM (SELECT A.SALES_CD
                                , SUM(A.SALES_AMT) AS SALES_AMT_1
                                , 0 AS SALES_AMT_2
                                , 0 AS SALES_AMT_3
                                , SUM(A.SALES_QTY * IFNULL(TMBC.COST,TPM.COST)) AS BUY_AMT_1
                                , 0 AS BUY_AMT_2
                                , 0 AS BUY_AMT_3
                           FROM (SELECT SALES_CD
                                        , PRDT_CD
                                        , SUM(PURE_AMT) AS SALES_AMT
                                        , SUM(SALES_QTY) AS SALES_QTY
                                   FROM TSH_SALES_DLV
                                  WHERE SALES_DT BETWEEN CONCAT(DATE_FORMAT(DATE_ADD(#{searchToDt}, INTERVAL -2 MONTH),'%Y%m'),'01') AND DATE_FORMAT(DATE_ADD(#{searchToDt}, INTERVAL -2 MONTH),'%Y%m%d')
                                    AND SALES_QTY != 0
                                  GROUP BY SALES_CD, PRDT_CD
                                UNION ALL
                                 SELECT SALES_CD
                                        , PRDT_CD
                                        , SUM(PURE_AMT)*-1 AS SALES_AMT
                                        , SUM(RTN_QTY)*-1 AS SALES_QTY
                                   FROM TSH_SALES_RETURN
                                  WHERE RTN_DT BETWEEN CONCAT(DATE_FORMAT(DATE_ADD(#{searchToDt}, INTERVAL -2 MONTH),'%Y%m'),'01') AND DATE_FORMAT(DATE_ADD(#{searchToDt}, INTERVAL -2 MONTH),'%Y%m%d')
                                    AND RTN_QTY != 0
                                  GROUP BY SALES_CD, PRDT_CD
                                ) A
                                LEFT OUTER JOIN TMH_MON_BUY_COST AS TMBC
                                    ON TMBC.PRDT_CD = A.PRDT_CD
                                   AND TMBC.YEAR_MON = DATE_FORMAT(DATE_ADD(#{searchFromDt}, INTERVAL -2 MONTH),'%Y%m')
                                LEFT OUTER JOIN TFM_PRDT_MST AS TPM
                                    ON TPM.PRDT_CD = A.PRDT_CD
                          GROUP BY A.SALES_CD
                        UNION ALL
                          SELECT A.SALES_CD
                                 , 0 AS SALES_AMT_1
                                 , SUM(A.SALES_AMT) AS SALES_AMT_2
                                 , 0 AS SALES_AMT_3
                                 , 0 AS BUY_AMT_1
                                 , SUM(A.SALES_QTY * IFNULL(TMBC.COST,TPM.COST)) AS BUY_AMT_2
                                 , 0 AS BUY_AMT_3
                            FROM (SELECT SALES_CD
                                         , PRDT_CD
                                         , SUM(PURE_AMT) AS SALES_AMT
                                         , SUM(SALES_QTY) AS SALES_QTY
                                    FROM TSH_SALES_DLV
                                   WHERE SALES_DT BETWEEN CONCAT(DATE_FORMAT(DATE_ADD(#{searchToDt}, INTERVAL -1 MONTH),'%Y%m'),'01') AND DATE_FORMAT(DATE_ADD(#{searchToDt}, INTERVAL -1 MONTH),'%Y%m%d')
                                     AND SALES_QTY != 0
                                   GROUP BY SALES_CD, PRDT_CD
                                 UNION ALL
                                  SELECT SALES_CD
                                         , PRDT_CD
                                         , SUM(PURE_AMT)*-1 AS SALES_AMT
                                         , SUM(RTN_QTY)*-1 AS SALES_QTY
                                    FROM TSH_SALES_RETURN
                                   WHERE RTN_DT BETWEEN CONCAT(DATE_FORMAT(DATE_ADD(#{searchToDt}, INTERVAL -1 MONTH),'%Y%m'),'01') AND DATE_FORMAT(DATE_ADD(#{searchToDt}, INTERVAL -1 MONTH),'%Y%m%d')
                                     AND RTN_QTY != 0
                                   GROUP BY SALES_CD, PRDT_CD
                                 ) A
                                 LEFT OUTER JOIN TMH_MON_BUY_COST AS TMBC
                                     ON TMBC.PRDT_CD = A.PRDT_CD
                                    AND TMBC.YEAR_MON = DATE_FORMAT(DATE_ADD(#{searchFromDt}, INTERVAL -1 MONTH),'%Y%m')
                                 LEFT OUTER JOIN TFM_PRDT_MST AS TPM
                                     ON TPM.PRDT_CD = A.PRDT_CD
                           GROUP BY A.SALES_CD
                        UNION ALL
                          SELECT A.SALES_CD
                                 , 0 AS SALES_AMT_1
                                 , 0 AS SALES_AMT_2
                                 , SUM(A.SALES_AMT) AS SALES_AMT_3
                                 , 0 AS BUY_AMT_1
                                 , 0 AS BUY_AMT_2
                                 , SUM(A.SALES_QTY * IFNULL(CONF_COST.COST,TPM.COST)) AS BUY_AMT_3
                            FROM (SELECT SALES_CD
                                         , PRDT_CD
                                         , SUM(PURE_AMT) AS SALES_AMT
                                         , SUM(A.SALES_QTY) AS SALES_QTY
                                    FROM TSH_SALES_DLV A
                                   WHERE SALES_DT BETWEEN #{searchFromDt} AND #{searchToDt}
                                     AND SALES_QTY != 0
                                   GROUP BY SALES_CD, PRDT_CD
                                 UNION ALL
                                  SELECT SALES_CD
                                         , PRDT_CD
                                         , SUM(PURE_AMT)*-1 AS SALES_AMT
                                         , SUM(RTN_QTY)*-1 AS SALES_QTY
                                    FROM TSH_SALES_RETURN
                                   WHERE RTN_DT BETWEEN #{searchFromDt} AND #{searchToDt}
                                     AND RTN_QTY != 0
                                   GROUP BY SALES_CD, PRDT_CD
                                 ) A
                                 
                                 LEFT OUTER JOIN
					               (SELECT A.PRDT_CD
									       , MAX(CASE WHEN DATE_FORMAT(#{searchFromDt}, '%Y%m') = DATE_FORMAT(NOW(), '%Y%m') THEN (CASE WHEN IFNULL(A.COST,0)=0 THEN A.CONF_COST ELSE A.COST END) ELSE A.CONF_COST END) AS COST
									  FROM (
									        SELECT LEFT(TPR.BUY_DT, 6) AS YEAR_MON
									               , TPR.PRDT_CD
									               , IFNULL(MAX(TPR.COST),0) AS COST
									               , 0 AS CONF_COST
									          FROM TBH_PRDT_RCPT AS TPR
									               JOIN
									                   (SELECT PRDT_CD, MAX(BUY_DT) AS MAX_BUY_DT
									                      FROM TBH_PRDT_RCPT
									                     WHERE BUY_DT LIKE CONCAT(DATE_FORMAT(#{searchFromDt}, '%Y%m') , '%')
									                       AND BUY_CONF_YN = 'Y'
									                       AND BUY_QTY != 0
									                     GROUP BY PRDT_CD
									                   ) AS A
									         WHERE TPR.BUY_DT = A.MAX_BUY_DT
									           AND TPR.PRDT_CD = A.PRDT_CD
									           AND TPR.BUY_CONF_YN = 'Y'
									           AND TPR.BUY_QTY != 0
									         GROUP BY LEFT(TPR.BUY_DT, 6), TPR.PRDT_CD
									     UNION ALL
									        SELECT YEAR_MON
									               , PRDT_CD
									               , 0 AS COST
									               , COST AS CONF_COST
									          FROM TMH_MON_BUY_COST
									         WHERE YEAR_MON = DATE_FORMAT(#{searchFromDt},'%Y%m')
									       ) AS A
									 GROUP BY A.PRDT_CD 
				          		   ) AS CONF_COST 
					                   ON CONF_COST.PRDT_CD = A.PRDT_CD
                                    
                                 LEFT OUTER JOIN TFM_PRDT_MST AS TPM
                                     ON TPM.PRDT_CD = A.PRDT_CD
                           GROUP BY A.SALES_CD
                         ) AS A
                         
                         JOIN
		                   (SELECT CASE WHEN #{searchHqClass}='10' THEN HQ_CD ELSE SALES_CD END AS HQ_CD
		                           , SALES_CD
		                      FROM V_SALES_HQ_CD
		                     WHERE HQ_CLASS = #{searchHqClass}
		                     <if test='searchHqClass == "10"'>
			                     <if test='searchSalesCd != null and searchSalesCd != ""'> 
	                               AND HQ_CD = #{searchSalesCd}
	                             </if>
                             </if>
                             <if test='searchHqClass == "20"'>
			                     <if test='searchSalesCd != null and searchSalesCd != ""'> 
	                               AND SALES_CD = #{searchSalesCd}
	                             </if>
                             </if>
		                   ) AS VSHC
		                   ON VSHC.SALES_CD = A.SALES_CD
                   
                   GROUP BY <if test='searchSalesCd != null and searchSalesCd != ""'>
                          VSHC.SALES_CD
                        </if>
                        <if test='searchSalesCd == null or searchSalesCd == ""'>
                          VSHC.HQ_CD
                        </if>
                 ) A
                 
                 JOIN TFM_SALES_ADD_INFO AS TSAI
                     ON TSAI.SALES_CD = A.SALES_CD
                     
                 LEFT OUTER JOIN TCM_CODE_DTL AS TCD
                     ON TCD.DTL_CD = TSAI.SALES_CLASS
                    AND TCD.COM_CD = 'M013'
                    
                 LEFT OUTER JOIN TFM_SALES_PR_MST AS TSPM
                     ON TSPM.SALES_PR_CD = TSAI.SALES_PR_CD
                  
          <where>            
            <if test='searchSalesClass != null and searchSalesClass != ""'>
              AND TSAI.SALES_CLASS = #{searchSalesClass}
            </if>
            <if test='searchSalesPrCd != null and searchSalesPrCd != ""'>
              AND TSAI.SALES_PR_CD = #{searchSalesPrCd}
            </if>
          </where>

	</select>
	

	<!-- 통합매출처이익률 Footer -->
	<select id="selectSalesTotPrftFooter" parameterType="com.doppio.workplace.as.service.SalSalesTotPrftListVo" resultType="com.doppio.workplace.as.service.SalSalesTotPrftListVo">
	/*SalSalesTotPrftListMapper.selectSalesTotPrftFooter*/	
         SELECT IFNULL(ROUND(CASE WHEN SUM(CASE WHEN TSAI.PROFIT_CLASS = '10' THEN A.BUY_AMT_1 ELSE A.SALES_AMT_1 END) = 0 THEN 0
                                 ELSE ( SUM(A.SALES_AMT_1) - SUM(A.BUY_AMT_1) ) / SUM( CASE WHEN TSAI.PROFIT_CLASS = '10' THEN A.BUY_AMT_1 ELSE A.SALES_AMT_1 END ) * 100
	                         END, 2), 0) AS MAR_RATE_SUM_1
			             
			    , IFNULL(ROUND(CASE WHEN SUM(CASE WHEN TSAI.PROFIT_CLASS = '10' THEN A.BUY_AMT_2 ELSE A.SALES_AMT_2 END) = 0 THEN 0
                             ELSE ( SUM(A.SALES_AMT_2) - SUM(A.BUY_AMT_2) ) / SUM( CASE WHEN TSAI.PROFIT_CLASS = '10' THEN A.BUY_AMT_2 ELSE A.SALES_AMT_2 END ) * 100
			             END, 2), 0) AS MAR_RATE_SUM_2
			    
			    , IFNULL(ROUND(CASE WHEN SUM(CASE WHEN TSAI.PROFIT_CLASS = '10' THEN A.BUY_AMT_3 ELSE A.SALES_AMT_3 END) = 0 THEN 0
                             ELSE ( SUM(A.SALES_AMT_3) - SUM(A.BUY_AMT_3)) / SUM( CASE WHEN TSAI.PROFIT_CLASS = '10' THEN A.BUY_AMT_3 ELSE A.SALES_AMT_3 END ) * 100
			             END, 2), 0) AS MAR_RATE_SUM_3
                
           FROM (SELECT <if test='searchSalesCd != null and searchSalesCd != ""'>
                          VSHC.SALES_CD
                        </if>
                        <if test='searchSalesCd == null or searchSalesCd == ""'>
                          VSHC.HQ_CD AS SALES_CD
                        </if>
                        , SUM(A.SALES_AMT_1) AS SALES_AMT_1
                        , SUM(A.SALES_AMT_2) AS SALES_AMT_2
                        , SUM(A.SALES_AMT_3) AS SALES_AMT_3
                        , SUM(A.BUY_AMT_1) AS BUY_AMT_1
                        , SUM(A.BUY_AMT_2) AS BUY_AMT_2
                        , SUM(A.BUY_AMT_3) AS BUY_AMT_3
                   FROM (SELECT A.SALES_CD
                                , SUM(A.SALES_AMT) AS SALES_AMT_1
                                , 0 AS SALES_AMT_2
                                , 0 AS SALES_AMT_3
                                , SUM(A.SALES_QTY * IFNULL(TMBC.COST,TPM.COST)) AS BUY_AMT_1
                                , 0 AS BUY_AMT_2
                                , 0 AS BUY_AMT_3
                           FROM (SELECT SALES_CD
                                        , PRDT_CD
                                        , SUM(PURE_AMT) AS SALES_AMT
                                        , SUM(SALES_QTY) AS SALES_QTY
                                   FROM TSH_SALES_DLV
                                  WHERE SALES_DT BETWEEN CONCAT(DATE_FORMAT(DATE_ADD(#{searchToDt}, INTERVAL -2 MONTH),'%Y%m'),'01') AND DATE_FORMAT(DATE_ADD(#{searchToDt}, INTERVAL -2 MONTH),'%Y%m%d')
                                    AND SALES_QTY != 0
                                  GROUP BY SALES_CD, PRDT_CD
                                UNION ALL
                                 SELECT SALES_CD
                                        , PRDT_CD
                                        , SUM(PURE_AMT)*-1 AS SALES_AMT
                                        , SUM(RTN_QTY)*-1 AS SALES_QTY
                                   FROM TSH_SALES_RETURN
                                  WHERE RTN_DT BETWEEN CONCAT(DATE_FORMAT(DATE_ADD(#{searchToDt}, INTERVAL -2 MONTH),'%Y%m'),'01') AND DATE_FORMAT(DATE_ADD(#{searchToDt}, INTERVAL -2 MONTH),'%Y%m%d')
                                    AND RTN_QTY != 0
                                  GROUP BY SALES_CD, PRDT_CD
                                ) A
                                LEFT OUTER JOIN TMH_MON_BUY_COST AS TMBC
                                    ON TMBC.PRDT_CD = A.PRDT_CD
                                   AND TMBC.YEAR_MON = DATE_FORMAT(DATE_ADD(#{searchFromDt}, INTERVAL -2 MONTH),'%Y%m')
                                LEFT OUTER JOIN TFM_PRDT_MST AS TPM
                                    ON TPM.PRDT_CD = A.PRDT_CD
                          GROUP BY A.SALES_CD
                        UNION ALL
                          SELECT A.SALES_CD
                                 , 0 AS SALES_AMT_1
                                 , SUM(A.SALES_AMT) AS SALES_AMT_2
                                 , 0 AS SALES_AMT_3
                                 , 0 AS BUY_AMT_1
                                 , SUM(A.SALES_QTY * IFNULL(TMBC.COST,TPM.COST)) AS BUY_AMT_2
                                 , 0 AS BUY_AMT_3
                            FROM (SELECT SALES_CD
                                         , PRDT_CD
                                         , SUM(PURE_AMT) AS SALES_AMT
                                         , SUM(SALES_QTY) AS SALES_QTY
                                    FROM TSH_SALES_DLV
                                   WHERE SALES_DT BETWEEN CONCAT(DATE_FORMAT(DATE_ADD(#{searchToDt}, INTERVAL -1 MONTH),'%Y%m'),'01') AND DATE_FORMAT(DATE_ADD(#{searchToDt}, INTERVAL -1 MONTH),'%Y%m%d')
                                     AND SALES_QTY != 0
                                   GROUP BY SALES_CD, PRDT_CD
                                 UNION ALL
                                  SELECT SALES_CD
                                         , PRDT_CD
                                         , SUM(PURE_AMT)*-1 AS SALES_AMT
                                         , SUM(RTN_QTY)*-1 AS SALES_QTY
                                    FROM TSH_SALES_RETURN
                                   WHERE RTN_DT BETWEEN CONCAT(DATE_FORMAT(DATE_ADD(#{searchToDt}, INTERVAL -1 MONTH),'%Y%m'),'01') AND DATE_FORMAT(DATE_ADD(#{searchToDt}, INTERVAL -1 MONTH),'%Y%m%d')
                                     AND RTN_QTY != 0
                                   GROUP BY SALES_CD, PRDT_CD
                                 ) A
                                 LEFT OUTER JOIN TMH_MON_BUY_COST AS TMBC
                                     ON TMBC.PRDT_CD = A.PRDT_CD
                                    AND TMBC.YEAR_MON = DATE_FORMAT(DATE_ADD(#{searchFromDt}, INTERVAL -1 MONTH),'%Y%m')
                                 LEFT OUTER JOIN TFM_PRDT_MST AS TPM
                                     ON TPM.PRDT_CD = A.PRDT_CD
                           GROUP BY A.SALES_CD
                        UNION ALL
                          SELECT A.SALES_CD
                                 , 0 AS SALES_AMT_1
                                 , 0 AS SALES_AMT_2
                                 , SUM(A.SALES_AMT) AS SALES_AMT_3
                                 , 0 AS BUY_AMT_1
                                 , 0 AS BUY_AMT_2
                                 , SUM(A.SALES_QTY * IFNULL(CONF_COST.COST,TPM.COST)) AS BUY_AMT_3
                            FROM (SELECT SALES_CD
                                         , PRDT_CD
                                         , SUM(PURE_AMT) AS SALES_AMT
                                         , SUM(A.SALES_QTY) AS SALES_QTY
                                    FROM TSH_SALES_DLV A
                                   WHERE SALES_DT BETWEEN #{searchFromDt} AND #{searchToDt}
                                     AND SALES_QTY != 0
                                   GROUP BY SALES_CD, PRDT_CD
                                 UNION ALL
                                  SELECT SALES_CD
                                         , PRDT_CD
                                         , SUM(PURE_AMT)*-1 AS SALES_AMT
                                         , SUM(RTN_QTY)*-1 AS SALES_QTY
                                    FROM TSH_SALES_RETURN
                                   WHERE RTN_DT BETWEEN #{searchFromDt} AND #{searchToDt}
                                     AND RTN_QTY != 0
                                   GROUP BY SALES_CD, PRDT_CD
                                 ) A
                                 
                                 LEFT OUTER JOIN
					               (SELECT A.PRDT_CD
									       , MAX(CASE WHEN DATE_FORMAT(#{searchFromDt}, '%Y%m') = DATE_FORMAT(NOW(), '%Y%m') THEN (CASE WHEN IFNULL(A.COST,0)=0 THEN A.CONF_COST ELSE A.COST END) ELSE A.CONF_COST END) AS COST
									  FROM (
									        SELECT LEFT(TPR.BUY_DT, 6) AS YEAR_MON
									               , TPR.PRDT_CD
									               , IFNULL(MAX(TPR.COST),0) AS COST
									               , 0 AS CONF_COST
									          FROM TBH_PRDT_RCPT AS TPR
									               JOIN
									                   (SELECT PRDT_CD, MAX(BUY_DT) AS MAX_BUY_DT
									                      FROM TBH_PRDT_RCPT
									                     WHERE BUY_DT LIKE CONCAT(DATE_FORMAT(#{searchFromDt}, '%Y%m') , '%')
									                       AND BUY_CONF_YN = 'Y'
									                       AND BUY_QTY != 0
									                     GROUP BY PRDT_CD
									                   ) AS A
									         WHERE TPR.BUY_DT = A.MAX_BUY_DT
									           AND TPR.PRDT_CD = A.PRDT_CD
									           AND TPR.BUY_CONF_YN = 'Y'
									           AND TPR.BUY_QTY != 0
									         GROUP BY LEFT(TPR.BUY_DT, 6), TPR.PRDT_CD
									     UNION ALL
									        SELECT YEAR_MON
									               , PRDT_CD
									               , 0 AS COST
									               , COST AS CONF_COST
									          FROM TMH_MON_BUY_COST
									         WHERE YEAR_MON = DATE_FORMAT(#{searchFromDt},'%Y%m')
									       ) AS A
									 GROUP BY A.PRDT_CD
				          		   ) AS CONF_COST
					                   ON CONF_COST.PRDT_CD = A.PRDT_CD
                                    
                                 LEFT OUTER JOIN TFM_PRDT_MST AS TPM
                                     ON TPM.PRDT_CD = A.PRDT_CD
                           GROUP BY A.SALES_CD
                         ) AS A
                         
                         JOIN
		                   (SELECT CASE WHEN #{searchHqClass}='10' THEN HQ_CD ELSE SALES_CD END AS HQ_CD
		                           , SALES_CD
		                      FROM V_SALES_HQ_CD
		                     WHERE HQ_CLASS = #{searchHqClass}
		                     <if test='searchHqClass == "10"'>
			                     <if test='searchSalesCd != null and searchSalesCd != ""'> 
	                               AND HQ_CD = #{searchSalesCd}
	                             </if>
                             </if>
                             <if test='searchHqClass == "20"'>
			                     <if test='searchSalesCd != null and searchSalesCd != ""'> 
	                               AND SALES_CD = #{searchSalesCd}
	                             </if>
                             </if>
		                   ) AS VSHC
		                   ON VSHC.SALES_CD = A.SALES_CD
                         
                   GROUP BY <if test='searchSalesCd != null and searchSalesCd != ""'>
	                          VSHC.SALES_CD
	                        </if>
	                        <if test='searchSalesCd == null or searchSalesCd == ""'>
	                          VSHC.HQ_CD
	                        </if>
                 ) A
                 
                 JOIN TFM_SALES_ADD_INFO AS TSAI
                     ON TSAI.SALES_CD = A.SALES_CD
                     
                 LEFT OUTER JOIN TCM_CODE_DTL AS TCD
                     ON TCD.DTL_CD = TSAI.SALES_CLASS
                    AND TCD.COM_CD = 'M013'
                    
                 LEFT OUTER JOIN TFM_SALES_PR_MST AS TSPM
                     ON TSPM.SALES_PR_CD = TSAI.SALES_PR_CD
                  
          <where>            
            <if test='searchSalesClass != null and searchSalesClass != ""'>
              AND TSAI.SALES_CLASS = #{searchSalesClass}
            </if>
            <if test='searchSalesPrCd != null and searchSalesPrCd != ""'>
              AND TSAI.SALES_PR_CD = #{searchSalesPrCd}
            </if>
          </where>

	</select>
	
	
	<!-- 통합매출처이익률(전월대비) 출력 조회 -->
	<select id="selectSalesTotPrftPrintList" parameterType="com.doppio.workplace.as.service.SalSalesTotPrftListVo" resultType="com.doppio.workplace.as.service.SalSalesTotPrftListVo">
	/*SalSalesTotPrftListMapper.selectSalesTotPrftPrintList*/	
         SELECT DATE_FORMAT(#{searchFromDt},'%Y-%m') AS TITLE
                , CONCAT(DATE_FORMAT(DATE_ADD(#{searchFromDt}, INTERVAL -1 MONTH),'%Y-%m'), ' 월') AS SUB_TITLE_1
                , CONCAT(DATE_FORMAT(#{searchFromDt},'%Y-%m'), ' 월') AS SUB_TITLE_2
                , CONCAT(DATE_FORMAT(#{searchFromDt},'%Y-%m'), ' 월') AS SUB_TITLE_3
                
                , DATE_FORMAT(#{searchFromDt},'%Y-%m-%d') AS START_DT
                , DATE_FORMAT(#{searchToDt},'%Y-%m-%d') AS END_DT
                
                , TSAI.SALES_NM
                
                , A.SALES_AMT_2 AS PRT_SALES_AMT_2
                
			    , A.SALES_AMT_3 AS PRT_SALES_AMT_3
                , A.SALES_AMT_3 - A.BUY_AMT_3 AS PRT_PROFIT_AMT_3
                , ROUND(CASE WHEN (CASE WHEN TSAI.PROFIT_CLASS = '10' THEN A.BUY_AMT_3 ELSE A.SALES_AMT_3 END) = 0 THEN 0
                             ELSE ( A.SALES_AMT_3 - A.BUY_AMT_3) / ( CASE WHEN TSAI.PROFIT_CLASS = '10' THEN A.BUY_AMT_3 ELSE A.SALES_AMT_3 END ) * 100
			             END, 2) AS PRT_MAR_RATE_3
                
                , TSPM.SALES_PR_NM
                , TSAI.SUBSIDY_RATE
                , ROW_NUMBER() OVER (PARTITION BY 1) 		AS COLUMN_CNT
                , FN_CODE_RTN('M004', #{searchHqClass})		AS HQ_CD_NM
           FROM (SELECT <if test='searchSalesCd != null and searchSalesCd != ""'>
                          VSHC.SALES_CD
                        </if>
                        <if test='searchSalesCd == null or searchSalesCd == ""'>
                          VSHC.HQ_CD AS SALES_CD
                        </if>
                        , SUM(A.SALES_AMT_2) AS SALES_AMT_2
                        , SUM(A.SALES_AMT_3) AS SALES_AMT_3
                        , SUM(A.BUY_AMT_3) AS BUY_AMT_3
                   FROM ( SELECT A.SALES_CD
                                 , SUM(A.SALES_AMT) AS SALES_AMT_2
                                 , 0 AS SALES_AMT_3
                                 , 0 AS BUY_AMT_3
                            FROM (SELECT SALES_CD
                                         , PRDT_CD
                                         , SUM(PURE_AMT) AS SALES_AMT
                                         , SUM(SALES_QTY) AS SALES_QTY
                                    FROM TSH_SALES_DLV
                                   WHERE SALES_DT BETWEEN CONCAT(DATE_FORMAT(DATE_ADD(REPLACE(#{searchToDt},'-',''), INTERVAL -1 MONTH),'%Y%m'),'01') AND DATE_FORMAT(DATE_ADD(REPLACE(#{searchToDt},'-',''), INTERVAL -1 MONTH),'%Y%m%d')
                                     AND SALES_QTY != 0
                                   GROUP BY SALES_CD, PRDT_CD
                                 UNION ALL
                                  SELECT SALES_CD
                                         , PRDT_CD
                                         , SUM(PURE_AMT)*-1 AS SALES_AMT
                                         , SUM(RTN_QTY)*-1 AS SALES_QTY
                                    FROM TSH_SALES_RETURN
                                   WHERE RTN_DT BETWEEN CONCAT(DATE_FORMAT(DATE_ADD(REPLACE(#{searchToDt},'-',''), INTERVAL -1 MONTH),'%Y%m'),'01') AND DATE_FORMAT(DATE_ADD(REPLACE(#{searchToDt},'-',''), INTERVAL -1 MONTH),'%Y%m%d')
                                     AND RTN_QTY != 0
                                   GROUP BY SALES_CD, PRDT_CD
                                 ) AS A
                           GROUP BY A.SALES_CD
                        UNION ALL
                          SELECT A.SALES_CD
                                 , 0 AS SALES_AMT_2
                                 , SUM(A.SALES_AMT) AS SALES_AMT_3
                                 , SUM(A.SALES_QTY * IFNULL(CONF_COST.COST,TPM.COST)) AS BUY_AMT_3
                            FROM (SELECT SALES_CD
                                         , PRDT_CD
                                         , SUM(PURE_AMT) AS SALES_AMT
                                         , SUM(A.SALES_QTY) AS SALES_QTY
                                    FROM TSH_SALES_DLV A
                                   WHERE SALES_DT BETWEEN REPLACE(#{searchFromDt},'-','') AND REPLACE(#{searchToDt},'-','')
                                     AND SALES_QTY != 0
                                   GROUP BY SALES_CD, PRDT_CD
                                 UNION ALL
                                  SELECT SALES_CD
                                         , PRDT_CD
                                         , SUM(PURE_AMT)*-1 AS SALES_AMT
                                         , SUM(RTN_QTY)*-1 AS SALES_QTY
                                    FROM TSH_SALES_RETURN
                                   WHERE RTN_DT BETWEEN REPLACE(#{searchFromDt},'-','') AND REPLACE(#{searchToDt},'-','')
                                     AND RTN_QTY != 0
                                   GROUP BY SALES_CD, PRDT_CD
                                 ) A
                                 
                                 LEFT OUTER JOIN
					               (SELECT A.PRDT_CD
									       , MAX(CASE WHEN DATE_FORMAT(REPLACE(#{searchFromDt},'-',''), '%Y%m') = DATE_FORMAT(NOW(), '%Y%m') THEN (CASE WHEN IFNULL(A.COST,0)=0 THEN A.CONF_COST ELSE A.COST END) ELSE A.CONF_COST END) AS COST
									  FROM (
									        SELECT LEFT(TPR.BUY_DT, 6) AS YEAR_MON
									               , TPR.PRDT_CD
									               , IFNULL(MAX(TPR.COST),0) AS COST
									               , 0 AS CONF_COST
									          FROM TBH_PRDT_RCPT AS TPR
									               JOIN
									                   (SELECT PRDT_CD, MAX(BUY_DT) AS MAX_BUY_DT
									                      FROM TBH_PRDT_RCPT
									                     WHERE BUY_DT LIKE CONCAT(DATE_FORMAT(REPLACE(#{searchFromDt},'-',''), '%Y%m') , '%')
									                       AND BUY_CONF_YN = 'Y'
									                       AND BUY_QTY != 0
									                     GROUP BY PRDT_CD
									                   ) AS A
									         WHERE TPR.BUY_DT = A.MAX_BUY_DT
									           AND TPR.PRDT_CD = A.PRDT_CD
									           AND TPR.BUY_CONF_YN = 'Y'
									           AND TPR.BUY_QTY != 0
									         GROUP BY LEFT(TPR.BUY_DT, 6), TPR.PRDT_CD
									     UNION ALL
									        SELECT YEAR_MON
									               , PRDT_CD
									               , 0 AS COST
									               , COST AS CONF_COST
									          FROM TMH_MON_BUY_COST
									         WHERE YEAR_MON = DATE_FORMAT(REPLACE(#{searchFromDt},'-',''),'%Y%m')
									       ) AS A
									 GROUP BY A.PRDT_CD
				          		   ) AS CONF_COST
					                   ON CONF_COST.PRDT_CD = A.PRDT_CD
                                    
                                 LEFT OUTER JOIN TFM_PRDT_MST AS TPM
                                     ON TPM.PRDT_CD = A.PRDT_CD
                                     
                           GROUP BY A.SALES_CD
                         ) AS A
                         
                         JOIN
		                   (SELECT CASE WHEN #{searchHqClass}='10' THEN HQ_CD ELSE SALES_CD END AS HQ_CD
		                           , SALES_CD
		                      FROM V_SALES_HQ_CD
		                     WHERE HQ_CLASS = #{searchHqClass}
		                     <if test='searchHqClass == "10"'>
			                     <if test='searchSalesCd != null and searchSalesCd != ""'> 
	                               AND HQ_CD = #{searchSalesCd}
	                             </if>
                             </if>
                             <if test='searchHqClass == "20"'>
			                     <if test='searchSalesCd != null and searchSalesCd != ""'> 
	                               AND SALES_CD = #{searchSalesCd}
	                             </if>
                             </if>
		                   ) AS VSHC
		                   ON VSHC.SALES_CD = A.SALES_CD
                         
                   GROUP BY <if test='searchSalesCd != null and searchSalesCd != ""'>
	                          VSHC.SALES_CD
	                        </if>
	                        <if test='searchSalesCd == null or searchSalesCd == ""'>
	                          VSHC.HQ_CD
	                        </if>
                 ) A
                 
                 JOIN TFM_SALES_ADD_INFO AS TSAI
                     ON TSAI.SALES_CD = A.SALES_CD
                     
                 LEFT OUTER JOIN TCM_CODE_DTL AS TCD
                     ON TCD.DTL_CD = TSAI.SALES_CLASS
                    AND TCD.COM_CD = 'M013'
                    
                 LEFT OUTER JOIN TFM_SALES_PR_MST AS TSPM
                     ON TSPM.SALES_PR_CD = TSAI.SALES_PR_CD
                  
          <where>            
            <if test='searchSalesClass != null and searchSalesClass != ""'>
              AND TSAI.SALES_CLASS = #{searchSalesClass}
            </if>
            <if test='searchSalesPrCd != null and searchSalesPrCd != ""'>
              AND TSAI.SALES_PR_CD = #{searchSalesPrCd}
            </if>
          </where>

	</select>
	
	
	<!-- 통합매출처이익률(전월대비) 엑셀 다운로드 -->
	<select id="selectSalSalesTotPrftListExcelDown" parameterType="com.doppio.workplace.as.service.SalSalesTotPrftListVo" resultType="java.util.HashMap">
	/*SalSalesTotPrftListMapper.selectSalSalesTotPrftListExcelDown*/	
         SELECT IFNULL(TCD.DTL_NM,'') AS SALES_CLASS_NM
                , TSAI.SALES_NM
                
                , IFNULL(A.SALES_AMT_1,0) AS SALES_AMT_1
                , IFNULL(A.SALES_AMT_1,0) - IFNULL(A.BUY_AMT_1,0) AS PROFIT_AMT_1
                , ROUND(CASE WHEN (CASE WHEN TSAI.PROFIT_CLASS = '10' THEN A.BUY_AMT_1 ELSE A.SALES_AMT_1 END) = 0 THEN 0
                             ELSE ( A.SALES_AMT_1 - A.BUY_AMT_1) / ( CASE WHEN TSAI.PROFIT_CLASS = '10' THEN A.BUY_AMT_1 ELSE A.SALES_AMT_1 END ) * 100
			             END, 2) AS MAR_RATE_1
			             
			    , IFNULL(A.SALES_AMT_2,0) AS SALES_AMT_2
                , IFNULL(A.SALES_AMT_2,0) - IFNULL(A.BUY_AMT_2,0) AS PROFIT_AMT_2
                , ROUND(CASE WHEN (CASE WHEN TSAI.PROFIT_CLASS = '10' THEN A.BUY_AMT_2 ELSE A.SALES_AMT_2 END) = 0 THEN 0
                             ELSE ( A.SALES_AMT_2 - A.BUY_AMT_2) / ( CASE WHEN TSAI.PROFIT_CLASS = '10' THEN A.BUY_AMT_2 ELSE A.SALES_AMT_2 END ) * 100
			             END, 2) AS MAR_RATE_2
			    
			    , IFNULL(A.BUY_AMT_3,0) AS BUY_AMT_3
                , IFNULL(A.SALES_AMT_3,0) AS SALES_AMT_3
                , IFNULL(A.SALES_AMT_3,0) - IFNULL(A.BUY_AMT_3,0) AS PROFIT_AMT_3
                , ROUND(CASE WHEN (CASE WHEN TSAI.PROFIT_CLASS = '10' THEN A.BUY_AMT_3 ELSE A.SALES_AMT_3 END) = 0 THEN 0
                             ELSE ( A.SALES_AMT_3 - A.BUY_AMT_3) / ( CASE WHEN TSAI.PROFIT_CLASS = '10' THEN A.BUY_AMT_3 ELSE A.SALES_AMT_3 END ) * 100
			             END, 2) AS MAR_RATE_3
                
                , IFNULL(TSPM.SALES_PR_NM,'') AS SALES_PR_NM
                , IFNULL(TSAI.SUBSIDY_RATE,0) AS SUBSIDY_RATE
           FROM (SELECT <if test='searchSalesCd != null and searchSalesCd != ""'>
                          VSHC.SALES_CD
                        </if>
                        <if test='searchSalesCd == null or searchSalesCd == ""'>
                          VSHC.HQ_CD AS SALES_CD
                        </if>
                        , SUM(A.SALES_AMT_1) AS SALES_AMT_1
                        , SUM(A.SALES_AMT_2) AS SALES_AMT_2
                        , SUM(A.SALES_AMT_3) AS SALES_AMT_3
                        , SUM(A.BUY_AMT_1) AS BUY_AMT_1
                        , SUM(A.BUY_AMT_2) AS BUY_AMT_2
                        , SUM(A.BUY_AMT_3) AS BUY_AMT_3
                   FROM (SELECT A.SALES_CD
                                , SUM(A.SALES_AMT) AS SALES_AMT_1
                                , 0 AS SALES_AMT_2
                                , 0 AS SALES_AMT_3
                                , SUM(A.SALES_QTY * IFNULL(TMBC.COST,TPM.COST)) AS BUY_AMT_1
                                , 0 AS BUY_AMT_2
                                , 0 AS BUY_AMT_3
                           FROM (SELECT SALES_CD
                                        , PRDT_CD
                                        , SUM(PURE_AMT) AS SALES_AMT
                                        , SUM(SALES_QTY) AS SALES_QTY
                                   FROM TSH_SALES_DLV
                                  WHERE SALES_DT BETWEEN CONCAT(DATE_FORMAT(DATE_ADD(REPLACE(#{searchToDt},'-',''), INTERVAL -2 MONTH),'%Y%m'),'01') AND DATE_FORMAT(DATE_ADD(REPLACE(#{searchToDt},'-',''), INTERVAL -2 MONTH),'%Y%m%d')
                                    AND SALES_QTY != 0
                                  GROUP BY SALES_CD, PRDT_CD
                                UNION ALL
                                 SELECT SALES_CD
                                        , PRDT_CD
                                        , SUM(PURE_AMT)*-1 AS SALES_AMT
                                        , SUM(RTN_QTY)*-1 AS SALES_QTY
                                   FROM TSH_SALES_RETURN
                                  WHERE RTN_DT BETWEEN CONCAT(DATE_FORMAT(DATE_ADD(REPLACE(#{searchToDt},'-',''), INTERVAL -2 MONTH),'%Y%m'),'01') AND DATE_FORMAT(DATE_ADD(REPLACE(#{searchToDt},'-',''), INTERVAL -2 MONTH),'%Y%m%d')
                                    AND RTN_QTY != 0
                                  GROUP BY SALES_CD, PRDT_CD
                                ) A
                                LEFT OUTER JOIN TMH_MON_BUY_COST AS TMBC
                                    ON TMBC.PRDT_CD = A.PRDT_CD
                                   AND TMBC.YEAR_MON = DATE_FORMAT(DATE_ADD(REPLACE(#{searchFromDt},'-',''), INTERVAL -2 MONTH),'%Y%m')
                                LEFT OUTER JOIN TFM_PRDT_MST AS TPM
                                    ON TPM.PRDT_CD = A.PRDT_CD
                          GROUP BY A.SALES_CD
                        UNION ALL
                          SELECT A.SALES_CD
                                 , 0 AS SALES_AMT_1
                                 , SUM(A.SALES_AMT) AS SALES_AMT_2
                                 , 0 AS SALES_AMT_3
                                 , 0 AS BUY_AMT_1
                                 , SUM(A.SALES_QTY * IFNULL(TMBC.COST,TPM.COST)) AS BUY_AMT_2
                                 , 0 AS BUY_AMT_3
                            FROM (SELECT SALES_CD
                                         , PRDT_CD
                                         , SUM(PURE_AMT) AS SALES_AMT
                                         , SUM(SALES_QTY) AS SALES_QTY
                                    FROM TSH_SALES_DLV
                                   WHERE SALES_DT BETWEEN CONCAT(DATE_FORMAT(DATE_ADD(REPLACE(#{searchToDt},'-',''), INTERVAL -1 MONTH),'%Y%m'),'01') AND DATE_FORMAT(DATE_ADD(REPLACE(#{searchToDt},'-',''), INTERVAL -1 MONTH),'%Y%m%d')
                                     AND SALES_QTY != 0
                                   GROUP BY SALES_CD, PRDT_CD
                                 UNION ALL
                                  SELECT SALES_CD
                                         , PRDT_CD
                                         , SUM(PURE_AMT)*-1 AS SALES_AMT
                                         , SUM(RTN_QTY)*-1 AS SALES_QTY
                                    FROM TSH_SALES_RETURN
                                   WHERE RTN_DT BETWEEN CONCAT(DATE_FORMAT(DATE_ADD(REPLACE(#{searchToDt},'-',''), INTERVAL -1 MONTH),'%Y%m'),'01') AND DATE_FORMAT(DATE_ADD(REPLACE(#{searchToDt},'-',''), INTERVAL -1 MONTH),'%Y%m%d')
                                     AND RTN_QTY != 0
                                   GROUP BY SALES_CD, PRDT_CD
                                 ) A
                                 LEFT OUTER JOIN TMH_MON_BUY_COST AS TMBC
                                     ON TMBC.PRDT_CD = A.PRDT_CD
                                    AND TMBC.YEAR_MON = DATE_FORMAT(DATE_ADD(REPLACE(#{searchFromDt},'-',''), INTERVAL -1 MONTH),'%Y%m')
                                 LEFT OUTER JOIN TFM_PRDT_MST AS TPM
                                     ON TPM.PRDT_CD = A.PRDT_CD
                           GROUP BY A.SALES_CD
                        UNION ALL
                          SELECT A.SALES_CD
                                 , 0 AS SALES_AMT_1
                                 , 0 AS SALES_AMT_2
                                 , SUM(A.SALES_AMT) AS SALES_AMT_3
                                 , 0 AS BUY_AMT_1
                                 , 0 AS BUY_AMT_2
                                 , SUM(A.SALES_QTY * IFNULL(TMBC.COST,TPM.COST)) AS BUY_AMT_3
                            FROM (SELECT SALES_CD
                                         , PRDT_CD
                                         , SUM(PURE_AMT) AS SALES_AMT
                                         , SUM(A.SALES_QTY) AS SALES_QTY
                                    FROM TSH_SALES_DLV A
                                   WHERE SALES_DT BETWEEN REPLACE(#{searchFromDt},'-','') AND REPLACE(#{searchToDt},'-','')
                                     AND SALES_QTY != 0
                                   GROUP BY SALES_CD, PRDT_CD
                                 UNION ALL
                                  SELECT SALES_CD
                                         , PRDT_CD
                                         , SUM(PURE_AMT)*-1 AS SALES_AMT
                                         , SUM(RTN_QTY)*-1 AS SALES_QTY
                                    FROM TSH_SALES_RETURN
                                   WHERE RTN_DT BETWEEN REPLACE(#{searchFromDt},'-','') AND REPLACE(#{searchToDt},'-','')
                                     AND RTN_QTY != 0
                                   GROUP BY SALES_CD, PRDT_CD
                                 ) A
                                 
                                 LEFT OUTER JOIN
					               (SELECT A.PRDT_CD
									       , MAX(CASE WHEN DATE_FORMAT(REPLACE(#{searchFromDt},'-',''), '%Y%m') = DATE_FORMAT(NOW(), '%Y%m') THEN (CASE WHEN IFNULL(A.COST,0)=0 THEN A.CONF_COST ELSE A.COST END) ELSE A.CONF_COST END) AS COST
									  FROM (
									        SELECT LEFT(TPR.BUY_DT, 6) AS YEAR_MON
									               , TPR.PRDT_CD
									               , IFNULL(MAX(TPR.COST),0) AS COST
									               , 0 AS CONF_COST
									          FROM TBH_PRDT_RCPT AS TPR
									               JOIN
									                   (SELECT PRDT_CD, MAX(BUY_DT) AS MAX_BUY_DT
									                      FROM TBH_PRDT_RCPT
									                     WHERE BUY_DT LIKE CONCAT(DATE_FORMAT(REPLACE(#{searchFromDt},'-',''), '%Y%m') , '%')
									                       AND BUY_CONF_YN = 'Y'
									                       AND BUY_QTY != 0
									                     GROUP BY PRDT_CD
									                   ) AS A
									         WHERE TPR.BUY_DT = A.MAX_BUY_DT
									           AND TPR.PRDT_CD = A.PRDT_CD
									           AND TPR.BUY_CONF_YN = 'Y'
									           AND TPR.BUY_QTY != 0
									         GROUP BY LEFT(TPR.BUY_DT, 6), TPR.PRDT_CD
									     UNION ALL
									        SELECT YEAR_MON
									               , PRDT_CD
									               , 0 AS COST
									               , COST AS CONF_COST
									          FROM TMH_MON_BUY_COST
									         WHERE YEAR_MON = DATE_FORMAT(REPLACE(#{searchFromDt},'-',''),'%Y%m')
									       ) AS A
									 GROUP BY A.PRDT_CD
				          		   ) AS CONF_COST
					                   ON CONF_COST.PRDT_CD = A.PRDT_CD
                                    
                                 LEFT OUTER JOIN TFM_PRDT_MST AS TPM
                                     ON TPM.PRDT_CD = A.PRDT_CD
                           GROUP BY A.SALES_CD
                         ) AS A
                         
                         JOIN
		                   (SELECT CASE WHEN #{searchHqClass}='10' THEN HQ_CD ELSE SALES_CD END AS HQ_CD
		                           , SALES_CD
		                      FROM V_SALES_HQ_CD
		                     WHERE HQ_CLASS = #{searchHqClass}
		                     <if test='searchHqClass == "10"'>
			                     <if test='searchSalesCd != null and searchSalesCd != ""'> 
	                               AND HQ_CD = #{searchSalesCd}
	                             </if>
                             </if>
                             <if test='searchHqClass == "20"'>
			                     <if test='searchSalesCd != null and searchSalesCd != ""'> 
	                               AND SALES_CD = #{searchSalesCd}
	                             </if>
                             </if>
		                   ) AS VSHC
		                   ON VSHC.SALES_CD = A.SALES_CD
                         
                   GROUP BY <if test='searchSalesCd != null and searchSalesCd != ""'>
	                          VSHC.SALES_CD
	                        </if>
	                        <if test='searchSalesCd == null or searchSalesCd == ""'>
	                          VSHC.HQ_CD AS SALES_CD
	                        </if>
                 ) A
                 
                 JOIN TFM_SALES_ADD_INFO AS TSAI
                     ON TSAI.SALES_CD = A.SALES_CD
                     
                 LEFT OUTER JOIN TCM_CODE_DTL AS TCD
                     ON TCD.DTL_CD = TSAI.SALES_CLASS
                    AND TCD.COM_CD = 'M013'
                    
                 LEFT OUTER JOIN TFM_SALES_PR_MST AS TSPM
                     ON TSPM.SALES_PR_CD = TSAI.SALES_PR_CD
                  
          <where>            
            <if test='searchSalesClass != null and searchSalesClass != ""'>
              AND TSAI.SALES_CLASS = #{searchSalesClass}
            </if>
            <if test='searchSalesPrCd != null and searchSalesPrCd != ""'>
              AND TSAI.SALES_PR_CD = #{searchSalesPrCd}
            </if>
          </where>
          
	</select>
	
</mapper>


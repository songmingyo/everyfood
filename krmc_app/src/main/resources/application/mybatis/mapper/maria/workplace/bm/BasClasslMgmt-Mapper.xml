<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.doppio.workplace.bm.service.impl.ClasslMgmtMapper">

	
	<!-- 대분류코드 조회 리스트 검색조건-->
	<sql id="selectClasslMgmtList_Where">
		/*ClasslMgmtMapper.selectClasslMgmtList_Where*/
		<where>
			<if test='lCd != null and lCd != ""'>				<!-- 대분류코드  --> 
				AND TPCM.L_CD LIKE CONCAT('%',#{lCd},'%')
			</if>	
			<if test='lNm != null and lNm != ""'>				<!-- 대분류코드명  --> 
				AND TPCM.L_NM LIKE CONCAT('%',#{lNm},'%')
			</if>
		</where>
	</sql>
	
	<!-- 대분류코드 조회  카운터 -->
	<select id="selectClasslMgmtListCount" parameterType="com.doppio.workplace.bm.service.ClasslMgmtVo" resultType="int">
		/* ClasslMgmtMapper.selectClasslMgmtListCount */
		SELECT COUNT(*) AS totalCount
		  FROM KRMC.TFM_PRDT_CLASS1_MST AS TPCM
		<include refid="selectClasslMgmtList_Where"/>
	</select>
	
	
	<!-- 대분류코드 조회 -->
	<select id="selectClasslMgmtList" parameterType="com.doppio.workplace.bm.service.ClasslMgmtVo" resultType="com.doppio.workplace.bm.service.ClasslMgmtVo">
	/*ClasslMgmtMapper.selectClasslMgmtList*/	
		      SELECT TPCM.L_CD
               , TPCM.L_NM
               , TPCM.USE_YN
               , TM_1.USER_NM AS REG_NM
               , TPCM.REG_DT
               , TM_1.USER_NM AS MOD_NM
               , TPCM.MOD_DT
		  FROM KRMC.TFM_PRDT_CLASS1_MST AS TPCM
				LEFT OUTER JOIN KRMC.TCM_MEMBER AS TM_1
		         ON TPCM.REG_ID = TM_1.USER_ID 
		       LEFT OUTER JOIN KRMC.TCM_MEMBER AS TM_2
		         ON TPCM.MOD_ID = TM_2.USER_ID
		 <include refid="selectClasslMgmtList_Where"/>
	</select>
	
		<!-- 대분류코드 조회(상세조회 ) -->
	<select id="selectClasslMgmtData" parameterType="com.doppio.workplace.bm.service.ClasslMgmtVo" resultType="com.doppio.workplace.bm.service.ClasslMgmtVo">
	/*ClasslMgmtMapper.selectClasslMgmtData*/	
	      SELECT TPCM.L_CD
               , TPCM.L_NM
               , TPCM.USE_YN
               , TM_1.USER_NM AS REG_NM
               , TPCM.REG_DT
               , TM_1.USER_NM AS MOD_NM
               , TPCM.MOD_DT
		  FROM KRMC.TFM_PRDT_CLASS1_MST AS TPCM
				LEFT OUTER JOIN KRMC.TCM_MEMBER AS TM_1
		         ON TPCM.REG_ID = TM_1.USER_ID 
		       LEFT OUTER JOIN KRMC.TCM_MEMBER AS TM_2
		         ON TPCM.MOD_ID = TM_2.USER_ID
		<where>
			AND TPCM.L_CD = #{lCd}
		</where>	
	</select>


	<!-- 대분류코드 업데이트 -->
	<insert id="updateClasslMgmt" parameterType="com.doppio.workplace.bm.service.ClasslMgmtVo">
	/*ClasslMgmtMapper.updateClasslMgmt*/	
        UPDATE TFM_PRDT_CLASS1_MST
           SET 	L_CD             = #{lCd}
               , L_NM           = #{lNm}
               , USE_YN             = #{useYn}
               , MOD_ID             = #{modId, jdbcType=VARCHAR}
               , MOD_DT             = NOW()
         WHERE L_CD = #{lCd}
	</insert>

	
	<!-- 대분류코드 등록 -->
	<insert id="insertClasslMgmt" parameterType="com.doppio.workplace.bm.service.ClasslMgmtVo">
	<selectKey keyProperty="lCd" resultType="String" order="BEFORE">
		SELECT CAST(IFNULL(MAX(TPCM.L_CD),'10') AS DECIMAL)+5 AS lCd FROM KRMC.TFM_PRDT_CLASS1_MST as TPCM
	</selectKey>
	/*ClasslMgmtMapper.insertClasslMgmt*/	
		INSERT INTO KRMC.TFM_PRDT_CLASS1_MST
			(L_CD, L_NM, USE_YN, REG_ID, REG_DT, MOD_ID, MOD_DT)
		VALUES
			(
				#{lCd}
			    , #{lNm}
			    , #{useYn}
			    , #{regId, jdbcType=VARCHAR}
			    , NOW()
			    , #{modId, jdbcType=VARCHAR}
			    , NOW()
			)
			ON DUPLICATE KEY UPDATE
				L_CD = #{lCd}
				, L_NM = #{lNm}
				, USE_YN = #{useYn}
				, MOD_ID = #{modId}
				, MOD_DT = NOW()

	</insert>
	
			<!-- 대분류코드 삭제 -->
		<insert id="deleteClasslMgmt" parameterType="com.doppio.workplace.bm.service.ClasslMgmtVo">
	/*ClasslMgmtMapper.deleteClasslMgmt*/	
	      DELETE FROM KRMC.TFM_PRDT_CLASS1_MST
			WHERE L_CD = #{lCd}
		
	</insert>

	
</mapper>